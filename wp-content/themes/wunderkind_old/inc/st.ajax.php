<?phpclass STAjax{    static function init(){        // Load more porfolio at home page        self::_loadMorePorfolio();    }    static function add_init_load_more_portfolio()    {            if(isset($_GET['load_more_portfolio']) and $_GET['load_more_portfolio'])            {                $page=isset($_GET['paged'])?$_GET['paged']:1;                $posts_per_page=isset($_GET['posts_per_page'])?$_GET['posts_per_page']:9;                $args=array(                    'post_type'=>'portfolio',                    'posts_per_page'=>$posts_per_page,                    'paged'=>$page+1,                    'order'=>'desc',                    'orderby'=>'modified'                );                if(isset($_GET['orderby']))                {                    $args['orderby']=$_GET['orderby'];                }                if(isset($_GET['order']))                {                    $args['order']=$_GET['order'];                }                if(isset($_GET['category']) and $_GET['category'])                {                    $args['tax_query'][]=array(                        'taxonomy'=>'portfolio_cat',                        'field'=>'term_id',                        'operator'=>'in',                        'terms'=>explode(',', $category)                    );                }                $html='';                query_posts($args);                if($have_post=have_posts())                {                    $html.='<div class="cbp-loadMore-block'.$page.'">';                }                $html.=st_load_template('loop','portfolio');                // while(have_posts())                // {                //     the_post();                //     $terms=wp_get_post_terms(get_the_ID(),'portfolio_cat');                //     $term_string='';                //     if(!empty($terms))                //     {                //         foreach($terms as $key=>$value)                //         {                //             $term_string.=' '.$value->slug;                //         }                //     }                //     $size=array(362, 272,'bfi_thumb'=>true);                //     $thumb=get_the_post_thumbnail(get_the_ID(),$size);                //     $full = wp_get_attachment_url( get_post_thumbnail_id(get_the_ID()) );                //     if($video=get_post_meta(get_the_ID(),'_cmb_embed_video',true))                //     {                //         $full=$video;                //     }                //     $permalink=get_the_permalink();                //     $title=get_the_title();                //     $html.="<li class='cbp-item {$term_string}'>                //             <figure>                //                         {$thumb}                //                         <figcaption>                //                             <a href='{$full}' class='cbp-lightbox' data-title='{$title}'><i class=\"fa fa-search fa-2x\"></i></a>                //                             <a href='{$permalink}' class=\"cbp-singlePage\"><i class=\"fa fa-expand fa-2x\"></i></a>                //                         </figcaption>                //                     </figure>                //         </li>";                // }                if($have_post)                {                    $html.='</div>';                }                global $wp_query;                $hasNext=false;                $totalPages=ceil($wp_query->found_posts/$posts_per_page);                if($totalPages==$page+1)                {                    $hasNext=false;                }else                {                    $hasNext=true;                }                echo json_encode(array(                    'hasNext'=>(int)$hasNext,'content'=>$html,                    'total'=>$wp_query->found_posts                ));                wp_reset_query();                die;            }    }    static private function _loadMorePorfolio()    {        add_action('init',array('STAjax','add_init_load_more_portfolio') );    }}